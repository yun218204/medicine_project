<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Personal Health Profile</title>
    <link rel="stylesheet" href="/css/index.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <nav class="navbar">
      <div class="logo">Personal Health</div>
      <ul class="navbar-links">
        <li><a href="/">é¦–é </a></li>
        <li><a href="/medicinerecord">ç”¨è—¥ç´€éŒ„</a></li>
        <li><a href="/healthy">é¤Šç”Ÿå°ˆæ¬„</a></li>
        <li><a href="contact">è¯çµ¡æˆ‘å€‘</a></li>
      </ul>
    </nav>
    <main>
      <section class="banner">
        <img src="https://i.imgur.com/gOoeiAc.jpg" alt="å¥åº·æ°´æœç›¤" />

        <div class="banner-text">
          <h1>å¥åº·ç”Ÿæ´»ï¼Œç°¡å–®é–‹å§‹</h1>
          <p>Healthy living, made simple</p>

          <% if (username) { %>
          <div class="user-info">
            <p class="user"><%= username %> æ­¡è¿!</p>
            <a href="/logout" class="logout-button">ç™»å‡º</a>
          </div>
          <% } else { %>
          <a href="/login" class="button">é–‹å§‹ä½¿ç”¨</a>
          <% } %>
        </div>
      </section>
      <section class="news">
        <h2><i>NEWS!!</i></h2>

        <% if (news.length >= 3) { %>
        <div class="news-wrapper">
          <!-- å·¦å´ä¸»æ–°è -->
          <div class="main-news">
            <img src="<%= news[0].image %>" alt="ä¸»æ–°èåœ–" />
            <h3><%= news[0].title %></h3>
            <p><%= news[0].description.slice(0, 80) %>...</p>
            <!-- å–å‰äº”åå€‹å­— -->
            <a href="<%= news[0].url %>" class="read-btn" target="_blank"
              >é–±è®€å…¨éƒ¨</a
            >
          </div>

          <!-- å³å´å…©å‰‡å°æ–°è -->
          <div class="side-news">
            <% news.slice(1, 3).forEach(article => { %>
            <div class="news-card">
              <img src="<%= article.image %>" alt="å‰¯æ–°èåœ–" />
              <h4><%= article.title %></h4>
              <p><%= article.description.slice(0, 40) %>...</p>
              <a href="<%= article.url %>" class="read-btn" target="_blank"
                >é–±è®€å…¨éƒ¨</a
              >
            </div>
            <% }) %>
          </div>
        </div>
        <% } else { %>
        <p>ç›®å‰æ–°èæ•¸é‡ä¸è¶³</p>
        <% } %>
      </section>
      <section class="health-group">
        <section class="health-tips">
          <h2><i>Health Tips</i></h2>
          <div class="swiper tips-swiper">
            <div class="swiper-wrapper">
              <% tips.forEach(tip => { %>
              <div class="swiper-slide tip-card">
                <p class="tip-zh"><%= tip.zh %></p>
                <p class="tip-en"><%= tip.en %></p>
              </div>
              <% }) %>
            </div>
            <div class="swiper-button-next"></div>
            <div class="swiper-button-prev"></div>
            <div class="swiper-pagination"></div>
          </div>
        </section>
        <section class="bmi">
          <h2><i>BMI è¨ˆç®—å™¨</i></h2>
          <form id="bmiForm">
            <label for="height">èº«é«˜ï¼ˆcmï¼‰</label>
            <input type="number" id="height" required placeholder="ä¾‹å¦‚ï¼š170" />

            <label for="weight">é«”é‡ï¼ˆkgï¼‰</label>
            <input type="number" id="weight" required placeholder="ä¾‹å¦‚ï¼š60" />

            <button type="submit">è¨ˆç®— BMI</button>
          </form>

          <div id="bmiResult" class="bmi-result"></div>
        </section>
      </section>
      <section class="chart" style="text-align: center; margin-top: 40px">
        <div style="max-width: 1000px; aspect-ratio: 2 / 1; margin: 0 auto">
          <canvas id="aqiChart"></canvas>
        </div>
        <div
          style="
            font-size: 14px;
            margin-top: 10px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
          "
        >
          <span style="color: #00e400">ğŸŸ© è‰¯å¥½ï¼ˆ0â€“50ï¼‰</span>
          <span style="color: #caca29">ğŸŸ¨ æ™®é€šï¼ˆ51â€“100ï¼‰</span>
          <span style="color: #ff7e00">ğŸŸ§ å°æ•æ„Ÿæ—ç¾¤ä¸å¥åº·ï¼ˆ101â€“150ï¼‰</span>
          <span style="color: #ff0000">ğŸŸ¥ ä¸å¥åº·ï¼ˆ151â€“200ï¼‰</span>
          <span style="color: #8f3f97">ğŸŸª éå¸¸ä¸å¥åº·ï¼ˆ201+ï¼‰</span>
        </div>
      </section>
    </main>
    <footer
      style="
        background-color: #f8f8f8;
        padding: 20px 0;
        text-align: center;
        font-size: 14px;
        color: #666;
        margin-top: 40px;
      "
    >
      <div>
        <p>&copy; 2025 Personal Health. All rights reserved.</p>
        <p>
          è¯çµ¡æˆ‘å€‘ï¼š<a href="mailto:contact@health.com" style="color: #4b82f1"
            >chen02964129@gmail.com</a
          >
        </p>
      </div>
    </footer>
  </body>
  <script src="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.js"></script>
  <script>
        //è¼ªæ’­
        const tipSwiper = new Swiper(".tips-swiper", {
          loop: true,
          slidesPerView: 1,
          autoplay: {
            delay: 4000,
            disableOnInteraction: false,
          },
          pagination: {
            el: ".swiper-pagination",
            clickable: true,
          },
          navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
          },
        });
        //bmiè¨ˆç®—
        document.getElementById("bmiForm").addEventListener("submit", function (e) {
          e.preventDefault();
          const height = parseFloat(document.getElementById("height").value);
          const weight = parseFloat(document.getElementById("weight").value);

          if (!height || !weight) {
            alert("è«‹æ­£ç¢ºè¼¸å…¥èº«é«˜èˆ‡é«”é‡ï¼");
            return;
          }

          const bmi = (weight / (height / 100) ** 2).toFixed(1);
          let category = "";

          if (bmi < 18.5) {
            category = "é«”é‡éè¼•";
          } else if (bmi < 24) {
            category = "æ­£å¸¸";
          } else if (bmi < 27) {
            category = "éé‡";
          } else {
            category = "è‚¥èƒ–";
          }

          document.getElementById("bmiResult").innerHTML = `
          <p>ä½ çš„ BMI ç‚ºï¼š<strong>${bmi}</strong></p>
          <p>é«”é‡åˆ†é¡ï¼š<strong>${category}</strong></p>
        `;
        });
        //chart.js
      const aqiData = <%- JSON.stringify(aqiData) %>;
    const labels = Object.keys(aqiData);
    const values = Object.values(aqiData);

    function getColor(aqi) {
      if (aqi <= 50) return "#00e400";
      if (aqi <= 100) return "#ffff00";
      if (aqi <= 150) return "#ff7e00";
      if (aqi <= 200) return "#ff0000";
      return "#8f3f97";
    }
    const barColors = values.map(getColor);

    const ctx = document.getElementById('aqiChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'AQI',
          data: values,
          backgroundColor: barColors
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            max: 200
          }
        },
        plugins: {
          legend: { display: false },
          title: {
            display: true,
            text: 'å„ç¸£å¸‚ç©ºæ°£å“è³ªæŒ‡æ•¸ï¼ˆAQIï¼‰'
          }
        }
      }
    });
  </script>
</html>
